<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Clément Poupelin">
<meta name="dcterms.date" content="2025-02-23">
<meta name="description" content="Ici, on continu sur des données de baseball en mettant en pratique les techniques de PCR et PLS avec de la validation croisée">

<title>Statistique en grande dimension - Exercice 06</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../img/logo_univ_nantes_simple.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../custom.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/logo_univ_nantes_complet.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">X3MS020</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../TP_StatGdeDim.pdf" rel="" target=""><i class="bi bi-file-earmark-font-fill" role="img">
</i> 
 <span class="menu-text">Feuille de TP</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/Clement-Poupelin" rel="" target="">
 <span class="dropdown-text">Clément Poupelin</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nonomtrt" rel="" target="">
 <span class="dropdown-text">Noémie Matrat</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-linkedin" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-linkedin">    
        <li>
    <a class="dropdown-item" href="http://www.linkedin.com/in/cl%C3%A9ment-poupelin-7675311a7/" rel="" target="">
 <span class="dropdown-text">Clément Poupelin</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.linkedin.com/in/no%C3%A9mie-matrat-86a34a200/" rel="" target="">
 <span class="dropdown-text">Noémie Matrat</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:clementjc.poupelin@gmail.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://clement-poupelin.github.io/" rel="" target=""><i class="bi bi-person-circle" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/clement__poupelin" rel="" target=""><i class="bi bi-instagram" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Exercice 06</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Ici, on continu sur des données de baseball en mettant en pratique les techniques de PCR et PLS avec de la validation croisée
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Régression sur composantes principales</div>
                <div class="quarto-category">Régression des moindres carrés partiels</div>
                <div class="quarto-category">Validation croisée</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Clément Poupelin </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 23, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intervenant.e.s" id="toc-intervenant.e.s" class="nav-link active" data-scroll-target="#intervenant.e.s">Intervenant.e.s</a>
  <ul class="collapse">
  <li><a href="#rédaction" id="toc-rédaction" class="nav-link" data-scroll-target="#rédaction">Rédaction</a></li>
  <li><a href="#relecture" id="toc-relecture" class="nav-link" data-scroll-target="#relecture">Relecture</a></li>
  </ul></li>
  <li><a href="#rappels-sur-pcr-et-pls" id="toc-rappels-sur-pcr-et-pls" class="nav-link" data-scroll-target="#rappels-sur-pcr-et-pls">Rappels sur PCR et PLS</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#données" id="toc-données" class="nav-link" data-scroll-target="#données">Données</a></li>
  <li><a href="#analyse-inférentielle" id="toc-analyse-inférentielle" class="nav-link" data-scroll-target="#analyse-inférentielle">Analyse Inférentielle</a></li>
  <li><a href="#prédiction" id="toc-prédiction" class="nav-link" data-scroll-target="#prédiction">Prédiction</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="intervenant.e.s" class="level1">
<h1>Intervenant.e.s</h1>
<section id="rédaction" class="level3">
<h3 class="anchored" data-anchor-id="rédaction">Rédaction</h3>
<ul>
<li><strong>Clément Poupelin</strong>, <a href="mailto:clementjc.poupelin@gmail.com" class="email">clementjc.poupelin@gmail.com</a><br>
</li>
</ul>
</section>
<section id="relecture" class="level3">
<h3 class="anchored" data-anchor-id="relecture">Relecture</h3>
<ul>
<li></li>
</ul>
</section>
</section>
<section id="rappels-sur-pcr-et-pls" class="level1">
<h1>Rappels sur PCR et PLS</h1>
<p>Dans l’analyse des données et la modélisation statistique, la régression linéaire classique peut être limitée lorsque les variables explicatives sont fortement corrélées (problème de colinéarité) ou lorsque leur nombre est supérieur au nombre d’observations (problème de haute dimensionnalité). Pour remédier à ces défis, des méthodes de réduction de dimensionnalité comme la Régression sur Composantes Principales (PCR) et la Régression des Moindres Carrés Partiels (PLS) sont utilisées.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">PCR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">PLS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Régression sur Composantes Principales (PCR) La PCR repose sur une Analyse en Composantes Principales (ACP) pour transformer les variables explicatives en nouvelles variables orthogonales appelées composantes principales. Seules les premières composantes, capturant le plus de variance, sont conservées dans la régression. Cette approche permet de réduire la multicolinéarité et d’éviter le sur-ajustement en limitant la complexité du modèle. Cependant, la PCR ne prend pas en compte la relation entre les variables explicatives et la variable réponse lors de la sélection des composantes.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Régression des Moindres Carrés Partiels (PLS) Contrairement à la PCR, la PLS cherche à maximiser la covariance entre les variables explicatives et la variable réponse. Elle construit des composantes latentes qui capturent non seulement la variance des variables explicatives mais aussi leur corrélation avec la variable à prédire. Cette méthode est souvent plus efficace que la PCR pour les problèmes de prédiction, car elle optimise directement la relation entre les prédicteurs et la réponse.</p>
</div>
</div>
</div>
<p>En résumé, la PCR est une approche basée sur la variance des prédicteurs, tandis que la PLS optimise la relation entre les prédicteurs et la réponse. Le choix entre ces deux méthodes dépend du contexte : la PCR est utile pour la réduction de dimensionnalité, tandis que la PLS est souvent plus performante pour la prédiction</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Packages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Fonctions</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Seed</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Données</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)         <span class="co"># Hitters data </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)        <span class="co"># manipulation des données</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Infrence</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls) <span class="do">## PCR et PLS</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ggplot</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Plot de validation</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my_validationplot <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, data) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  msep.cv <span class="ot">&lt;-</span> <span class="fu">MSEP</span>(mod, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>, <span class="st">"adjCV"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  rmsep.cv <span class="ot">&lt;-</span> <span class="fu">RMSEP</span>(mod, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>, <span class="st">"adjCV"</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  x_msep <span class="ot">&lt;-</span> <span class="fu">c</span>(msep.cv<span class="sc">$</span>val[<span class="dv">1</span>, , ], msep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  x_rmsep <span class="ot">&lt;-</span> <span class="fu">c</span>(rmsep.cv<span class="sc">$</span>val[<span class="dv">1</span>, , ], rmsep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CV"</span>, <span class="fu">length</span>(msep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])), <span class="fu">rep</span>(<span class="st">"adjCV"</span>, <span class="fu">length</span>(msep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">ncol</span>(data) <span class="sc">-</span> <span class="dv">1</span>), <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ncol</span>(data) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x_msep, x_rmsep, y, z)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(dt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MSEP"</span>, <span class="st">"RMSEP"</span>, <span class="st">"sample"</span>, <span class="st">"comps"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  p.msep <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dt, <span class="fu">aes</span>(<span class="at">x =</span> comps, <span class="at">y =</span> MSEP, <span class="at">col =</span> sample)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  p.rmsep <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dt, <span class="fu">aes</span>(<span class="at">x =</span> comps, <span class="at">y =</span> RMSEP, <span class="at">col =</span> sample)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">MSEP =</span> p.msep, <span class="at">RMSEP =</span> p.rmsep))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">140400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="données" class="level1">
<h1>Données</h1>
<p>On étudie à nouveau le jeu de données <a href="https://rdrr.io/cran/ISLR/man/Hitters.html"><strong>Hitters</strong></a> disponible dans la libraire <em><code>{ISLR}</code></em> de <em><code>R</code></em>. Il s’agit d’un jeu de données de la <em>Major League Baseball</em> provenant des saisons de 1986 et 1987.</p>
<p>Le jeu de données possède 322 lignes/individus pour les différents joueurs et 20 variables.<br>
Parmi les variables, on trouve les informations suivantes :</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-hover table-condensed table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">AtBat</span></td>
<td style="text-align: left;">Number of times at bat in 1986</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Hits</span></td>
<td style="text-align: left;">Number of hits in 1986</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">HmRun</span></td>
<td style="text-align: left;">Number of home runs in 1986</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Runs</span></td>
<td style="text-align: left;">Number of runs in 1986</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">RBI</span></td>
<td style="text-align: left;">Number of runs batted in in 1986</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Walks</span></td>
<td style="text-align: left;">Number of walks in 1986</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Years</span></td>
<td style="text-align: left;">Number of years in the major leagues</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">CAtBat</span></td>
<td style="text-align: left;">Number of times at bat during his career</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">CHits</span></td>
<td style="text-align: left;">Number of hits during his career</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">CHmRun</span></td>
<td style="text-align: left;">Number of home runs during his career</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">CRuns</span></td>
<td style="text-align: left;">Number of runs during his career</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">CRBI</span></td>
<td style="text-align: left;">Number of runs batted in during his career</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">CWalks</span></td>
<td style="text-align: left;">Number of walks during his career</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">League</span></td>
<td style="text-align: left;">A factor with levels A and N indicating player's league at the end of 1986</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Division</span></td>
<td style="text-align: left;">A factor with levels E and W indicating player's division at the end of 1986</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">PutOuts</span></td>
<td style="text-align: left;">Number of put outs in 1986</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Assists</span></td>
<td style="text-align: left;">Number of assists in 1986</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Errors</span></td>
<td style="text-align: left;">Number of errors in 1986</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style=" font-weight: bold;    ">Salary</span></td>
<td style="text-align: left;">1987 annual salary on opening day in thousands of dollars</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style=" font-weight: bold;    ">NewLeague</span></td>
<td style="text-align: left;">A factor with levels A and N indicating player's league at the beginning of 1987</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Comme pour l’<a href="../posts/Exercice_01.html">Exercice 1</a>, on va commencer par se débarasser des variables manquantes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Hitters_Without_NA <span class="ot">&lt;-</span> Hitters <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Comme cela fait maintenant plusieurs fois que l’on fait affaire à ce jeu de données, on se passera des analyses descritpives faites en <a href="../posts/Exercice_01.html">Exercice 1</a>.</p>
<p>Ainsi, on va pouvoir tout de suite commencer par faire le découpage de notre jeu de données en échantillon <em>train</em> et <em>test</em>. Le jeu de données <em>train</em> contiendra 3/4 des individus sans valeurs manquantes de Hitters, tirés aléatoirement. Le reste du jeu de données composera l’échantillon <em>test</em>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>percent_to_draw <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>index_train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(Hitters_Without_NA), <span class="at">size =</span> <span class="fu">floor</span>(percent_to_draw <span class="sc">*</span> <span class="fu">nrow</span>(Hitters_Without_NA)))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Hitters_train <span class="ot">&lt;-</span> Hitters_Without_NA[index_train, ]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Hitters_test <span class="ot">&lt;-</span> Hitters_Without_NA[<span class="sc">-</span>index_train, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analyse-inférentielle" class="level1">
<h1>Analyse Inférentielle</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">PCR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">PLS</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mod_pcr <span class="ot">&lt;-</span> <span class="fu">pcr</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  Salary <span class="sc">~</span> .,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Hitters_train,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">segments =</span> <span class="dv">10</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>mod_pcr <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 197 19 
    Y dimension: 197 1
Fit method: svdpc
Number of components considered: 19

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV           451.6    359.2    360.4    362.1    358.4    355.4    361.6
adjCV        451.6    358.6    359.6    361.3    357.6    354.6    360.3
       7 comps  8 comps  9 comps  10 comps  11 comps  12 comps  13 comps
CV       362.3    367.7    373.1     374.9     376.3     378.2     378.9
adjCV    360.8    365.8    370.9     372.2     373.7     375.4     376.0
       14 comps  15 comps  16 comps  17 comps  18 comps  19 comps
CV        372.9     375.5       352     350.3     349.2     349.8
adjCV     369.6     372.2       349     347.1     345.9     346.4

TRAINING: % variance explained
        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps  8 comps
X         38.57    60.46     71.0    79.17    84.43    88.90    92.26     95.1
Salary    39.51    40.48     40.6    42.04    43.04    44.32    45.36     45.8
        9 comps  10 comps  11 comps  12 comps  13 comps  14 comps  15 comps
X         96.48     97.43     98.12     98.70     99.18      99.5     99.75
Salary    45.81     47.70     47.71     48.14     48.26      51.2     51.55
        16 comps  17 comps  18 comps  19 comps
X          99.91     99.97     99.99    100.00
Salary     57.09     58.10     58.89     59.19</code></pre>
</div>
</div>
<p>On peut maintenant visualiser l’évolution du MSEP et RMSEP enfonction du nombre de composantes gardées.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="fu">my_validationplot</span>(mod_pcr, Hitters_train)<span class="sc">$</span>MSEP,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">my_validationplot</span>(mod_pcr, Hitters_train)<span class="sc">$</span>RMSEP,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>On peut voir courbe proche entre CV et adjCV avec une valeur minimum qui semble se trouver pour 6 composantes.</p>
<p>Et on petut alors récupérer le nombre de composantes à garder qui minimsent le MSEP et RMSEP.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ncomp.rmsep_pcr <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(mod_pcr, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>))<span class="sc">$</span>val[<span class="st">"CV"</span>,,])<span class="sc">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mod_pls <span class="ot">&lt;-</span> <span class="fu">plsr</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  Salary <span class="sc">~</span> .,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Hitters_train,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">segments =</span> <span class="dv">10</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>mod_pls <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 197 19 
    Y dimension: 197 1
Fit method: kernelpls
Number of components considered: 19

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV           451.6    353.8    354.0    355.4    354.6    358.6    354.5
adjCV        451.6    353.3    353.1    354.5    353.0    355.7    351.3
       7 comps  8 comps  9 comps  10 comps  11 comps  12 comps  13 comps
CV       346.0    338.3    336.1     337.5     335.9     332.6     332.7
adjCV    343.4    336.0    333.7     335.2     333.3     330.3     330.4
       14 comps  15 comps  16 comps  17 comps  18 comps  19 comps
CV        329.2     330.3     331.1     329.8     329.1     329.4
adjCV     327.1     328.1     328.7     327.6     326.9     327.2

TRAINING: % variance explained
        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps  8 comps
X         38.35    51.49    65.93     72.1    76.66    83.61    87.75    89.94
Salary    41.91    45.71    47.66     49.8    52.71    54.18    55.37    56.92
        9 comps  10 comps  11 comps  12 comps  13 comps  14 comps  15 comps
X         93.10     95.65     96.66     97.49     98.39     98.58     99.05
Salary    57.52     57.78     58.24     58.40     58.52     58.81     58.88
        16 comps  17 comps  18 comps  19 comps
X          99.41     99.74     99.99    100.00
Salary     58.97     59.05     59.09     59.19</code></pre>
</div>
</div>
<p>On peut maintenant visualiser l’évolution du MSEP et RMSEP enfonction du nombre de composantes gardées.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="fu">my_validationplot</span>(mod_pls, Hitters_train)<span class="sc">$</span>MSEP,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">my_validationplot</span>(mod_pls, Hitters_train)<span class="sc">$</span>RMSEP,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>On peut voir courbe proche entre CV et adjCV avec une valeur minimum qui semble se trouver pour 6 composantes.</p>
<p>Et on petut alors récupérer le nombre de composantes à garder qui minimsent le MSEP et RMSEP.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ncomp.rmsep_pls <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(mod_pls, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>))<span class="sc">$</span>val[<span class="st">"CV"</span>,,])<span class="sc">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="prédiction" class="level1">
<h1>Prédiction</h1>
<p>On va calculer le RMSEP calculé à partir de la prédiction pour l’échantillon test.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hat_Hitters_test_mod_pcr <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_pcr, Hitters_test, <span class="at">ncomp =</span>  (<span class="fu">which.min</span>(<span class="fu">RMSEP</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  mod_pcr, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>val[<span class="st">"CV"</span>, , ]) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>rmsep_mod_pcr <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  hat_Hitters_test_mod_pcr <span class="sc">-</span> Hitters_test<span class="sc">$</span>Salary</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">**</span> <span class="dv">2</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pls <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_pls, Hitters_test, <span class="at">ncomp =</span>  (<span class="fu">which.min</span>(<span class="fu">RMSEP</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  mod_pls, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>val[<span class="st">"CV"</span>, , ]) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>rmsep_mod_pls <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  hat_df_test_salary.pls <span class="sc">-</span> Hitters_test<span class="sc">$</span>Salary</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">**</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rmsep_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"prediction PCR"</span> <span class="ot">=</span> rmsep_mod_pcr, <span class="st">"prediction PLS"</span> <span class="ot">=</span> rmsep_mod_pls) </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rmsep_df) <span class="ot">&lt;-</span> <span class="st">"RMSEP"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rmsep_df </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      prediction.PCR prediction.PLS
RMSEP       369.5149       373.6123</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
</section>
<section id="session-info" class="level1">
<h1>Session info</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>(<span class="at">pkgs =</span> <span class="st">"attached"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.1 (2022-06-23 ucrt)
 os       Windows 10 x64 (build 22631)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  French_France.utf8
 ctype    French_France.utf8
 tz       Europe/Paris
 date     2025-02-23
 pandoc   3.2 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package    * version date (UTC) lib source
 dplyr      * 1.1.4   2023-11-17 [1] CRAN (R 4.2.3)
 forcats    * 1.0.0   2023-01-29 [1] CRAN (R 4.2.2)
 ggplot2    * 3.5.1   2024-04-23 [1] CRAN (R 4.2.3)
 gridExtra  * 2.3     2017-09-09 [1] CRAN (R 4.2.1)
 ISLR       * 1.4     2021-09-15 [1] CRAN (R 4.2.3)
 kableExtra * 1.4.0   2024-01-24 [1] CRAN (R 4.2.3)
 lubridate  * 1.9.3   2023-09-27 [1] CRAN (R 4.2.3)
 pls        * 2.8-3   2023-11-17 [1] CRAN (R 4.2.3)
 purrr      * 1.0.2   2023-08-10 [1] CRAN (R 4.2.3)
 readr      * 2.1.5   2024-01-10 [1] CRAN (R 4.2.3)
 stringr    * 1.5.1   2023-11-14 [1] CRAN (R 4.2.3)
 tibble     * 3.2.1   2023-03-20 [1] CRAN (R 4.2.3)
 tidyr      * 1.3.1   2024-01-24 [1] CRAN (R 4.2.3)
 tidyverse  * 2.0.0   2023-02-22 [1] CRAN (R 4.2.2)

 [1] C:/Users/cleme/AppData/Local/R/win-library/4.2
 [2] C:/Program Files/R/R-4.2.1/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">na.omit</span>(Hitters)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 263  20</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>pourcentage_a_tirer <span class="ot">=</span> <span class="fl">0.75</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>indices_train <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df), <span class="at">size =</span> <span class="fu">floor</span>(pourcentage_a_tirer <span class="sc">*</span> <span class="fu">nrow</span>(df)))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">=</span> df[indices_train, ]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 197  20</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">=</span> df[<span class="sc">-</span>indices_train, ] </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 66 20</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 1.5 --------------------------------------------------------------</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># faire une selec forwise-stepwise avec critere BIC sur train puis rmsep sur test</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>mod0<span class="ot">=</span><span class="fu">lm</span>(Salary<span class="sc">~</span><span class="dv">0</span>, <span class="at">data=</span>df_train)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>mod_full<span class="ot">=</span><span class="fu">lm</span>(Salary<span class="sc">~</span>., <span class="at">data=</span>df_train)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>mod.step <span class="ot">=</span> <span class="fu">step</span>(mod0, <span class="at">scope =</span> <span class="fu">formula</span>(mod_full), <span class="at">trace =</span> <span class="cn">FALSE</span>, <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">k =</span> <span class="fu">log</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in log(n): argument non numérique pour une fonction mathématique</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in summary(mod.step): objet 'mod.step' introuvable</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># significativité de nos 3 var (CRuns Walks CWalks) + r2 =&gt; mod  pas trop mal</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># grosse standard error</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>hat_df_test_mod.step <span class="ot">=</span> <span class="fu">predict</span>(mod.step, df_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in predict(mod.step, df_test): objet 'mod.step' introuvable</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>rmsep_mod.step <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_mod.step <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in mean((hat_df_test_mod.step - df_test$Salary)^2): objet 'hat_df_test_mod.step' introuvable</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>rmsep_mod.step</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): objet 'rmsep_mod.step' introuvable</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 357.7089</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 2 --------------------------------------------------------------</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>salary.pcr <span class="ot">=</span> <span class="fu">pcr</span>(Salary <span class="sc">~</span>., <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> df_train, <span class="at">validation =</span> <span class="st">"CV"</span>, <span class="at">segments=</span><span class="dv">10</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salary.pcr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 197 19 
    Y dimension: 197 1
Fit method: svdpc
Number of components considered: 19

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV           480.9    362.8    364.2    364.4    359.7    355.5    359.4
adjCV        480.9    362.3    363.6    363.8    358.9    354.6    358.2
       7 comps  8 comps  9 comps  10 comps  11 comps  12 comps  13 comps
CV       360.2    363.8    365.5     358.3     360.0     359.9     361.7
adjCV    358.9    362.4    363.9     356.5     358.2     358.1     360.0
       14 comps  15 comps  16 comps  17 comps  18 comps  19 comps
CV        348.9     348.6     343.3     343.5     343.6     345.8
adjCV     346.7     346.5     341.2     341.2     341.2     343.3

TRAINING: % variance explained
        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps  8 comps
X         40.51    60.57    71.15    79.89    85.15    89.29    92.85    95.30
Salary    45.77    45.85    46.38    47.72    49.65    50.36    50.76    50.76
        9 comps  10 comps  11 comps  12 comps  13 comps  14 comps  15 comps
X         96.53     97.46     98.13     98.74     99.16     99.51     99.77
Salary    51.02     53.82     54.07     54.25     54.60     58.06     58.32
        16 comps  17 comps  18 comps  19 comps
X          99.90     99.97     99.99    100.00
Salary     59.87     60.62     61.27     61.27</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pcr, <span class="at">val.type =</span> <span class="st">"RMSEP"</span>) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pcr, <span class="at">val.type =</span> <span class="st">"MSEP"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># validationplot(salary.pcr, val.type = "R2") # inutile car augment tout le temps en fonction des composantes </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>salary.pcr<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1 comps

              Salary
AtBat      26.854472
Hits       26.349011
HmRun      24.171415
Runs       25.846286
RBI        29.459770
Walks      25.548791
Years      30.927868
CAtBat     37.133303
CHits      37.361129
CHmRun     35.836624
CRuns      38.290782
CRBI       37.990129
CWalks     35.532417
LeagueN    -6.506781
DivisionW  -6.460451
PutOuts    12.180892
Assists     3.897012
Errors      4.353903
NewLeagueN -6.135108

, , 2 comps

              Salary
AtBat      29.333553
Hits       28.794921
HmRun      25.648648
Runs       28.310510
RBI        31.424972
Walks      27.206460
Years      28.926963
CAtBat     35.664424
CHits      35.970834
CHmRun     34.694334
CRuns      36.992021
CRBI       36.625681
CWalks     34.160311
LeagueN    -6.963243
DivisionW  -6.620092
PutOuts    13.162983
Assists     5.085790
Errors      5.743577
NewLeagueN -6.512359

, , 3 comps

              Salary
AtBat      30.978109
Hits       30.116447
HmRun      20.336701
Runs       27.155811
RBI        29.335421
Walks      27.950677
Years      29.935424
CAtBat     37.586247
CHits      37.835850
CHmRun     32.900245
CRuns      38.144713
CRBI       36.954979
CWalks     35.059759
LeagueN     6.548067
DivisionW  -6.942130
PutOuts    14.387197
Assists    14.678390
Errors     15.427186
NewLeagueN  7.075892

, , 4 comps

               Salary
AtBat       29.520862
Hits        29.000181
HmRun       31.597403
Runs        29.026827
RBI         36.231434
Walks       32.404842
Years       26.080137
CAtBat      33.710392
CHits       34.178113
CHmRun      37.369031
CRuns       35.351888
CRBI        37.332692
CWalks      34.488907
LeagueN     24.033667
DivisionW  -10.089502
PutOuts     26.571953
Assists     -7.543320
Errors      -2.246405
NewLeagueN  24.653697

, , 5 comps

               Salary
AtBat       27.694268
Hits        29.646194
HmRun       25.730261
Runs        33.481790
RBI         33.235304
Walks       37.877679
Years       24.820145
CAtBat      32.238744
CHits       33.201307
CHmRun      33.599843
CRuns       37.075568
CRBI        33.728773
CWalks      38.302157
LeagueN     24.734546
DivisionW  -73.675797
PutOuts     11.097175
Assists     -6.114206
Errors      -7.340447
NewLeagueN  23.574869

, , 6 comps

               Salary
AtBat       25.273285
Hits        25.819565
HmRun       16.169143
Runs        28.421368
RBI         26.169617
Walks       40.205973
Years       26.395457
CAtBat      32.797369
CHits       33.780569
CHmRun      30.483180
CRuns       36.843164
CRBI        33.242844
CWalks      40.029970
LeagueN     17.581534
DivisionW  -82.399864
PutOuts     51.909973
Assists     -3.241560
Errors      -4.425967
NewLeagueN  17.212353

, , 7 comps

               Salary
AtBat       27.977563
Hits        30.025511
HmRun       -1.166145
Runs        36.724811
RBI         15.573862
Walks       61.204572
Years       25.788362
CAtBat      33.071120
CHits       34.127110
CHmRun      22.814001
CRuns       39.257148
CRBI        29.517381
CWalks      47.866368
LeagueN     16.895528
DivisionW  -74.763437
PutOuts     48.229118
Assists     -4.505340
Errors     -18.631510
NewLeagueN  18.148813

, , 8 comps

               Salary
AtBat       28.894779
Hits        31.269987
HmRun       -2.117039
Runs        36.992026
RBI         15.722128
Walks       59.537377
Years       26.310089
CAtBat      33.512949
CHits       34.702753
CHmRun      22.128929
CRuns       39.401350
CRBI        29.562126
CWalks      46.851897
LeagueN     16.816210
DivisionW  -74.844194
PutOuts     48.383456
Assists     -4.797926
Errors     -19.560821
NewLeagueN  18.396900

, , 9 comps

               Salary
AtBat       31.588787
Hits        28.053736
HmRun        7.083675
Runs        28.472560
RBI         18.929344
Walks       56.701587
Years       21.787342
CAtBat      32.114883
CHits       31.268723
CHmRun      29.699273
CRuns       36.938402
CRBI        31.466240
CWalks      47.987748
LeagueN     18.648360
DivisionW  -74.494016
PutOuts     51.019658
Assists     31.089710
Errors     -50.830829
NewLeagueN  18.895451

, , 10 comps

               Salary
AtBat       49.366949
Hits        56.945636
HmRun      -55.944625
Runs        34.275461
RBI         -9.144111
Walks       30.921233
Years      -96.415955
CAtBat      14.681773
CHits       25.801160
CHmRun     135.260541
CRuns       51.042755
CRBI        80.319924
CWalks      46.306896
LeagueN     44.447574
DivisionW  -75.492297
PutOuts     50.925897
Assists     17.200828
Errors     -42.036656
NewLeagueN -11.590862

, , 11 comps

               Salary
AtBat       56.836309
Hits        59.598129
HmRun      -78.166380
Runs        -1.486379
RBI         21.689129
Walks       51.048130
Years      -92.608432
CAtBat      10.927660
CHits       24.000140
CHmRun     143.663268
CRuns       37.708144
CRBI        92.380904
CWalks      35.945707
LeagueN     23.954772
DivisionW  -77.516613
PutOuts     45.938939
Assists     12.914266
Errors     -40.169010
NewLeagueN   4.763255

, , 12 comps

                Salary
AtBat        55.347029
Hits         55.674880
HmRun       -70.702147
Runs         11.058391
RBI           7.478159
Walks        43.670028
Years      -105.439583
CAtBat       11.838445
CHits        25.367169
CHmRun      149.102001
CRuns        45.162903
CRBI         90.774398
CWalks       38.953637
LeagueN     -13.276625
DivisionW   -78.201094
PutOuts      46.618093
Assists      14.620874
Errors      -39.060853
NewLeagueN   43.037827

, , 13 comps

                Salary
AtBat        38.421707
Hits         53.918821
HmRun       -67.263177
Runs         -8.469744
RBI          40.386940
Walks        39.097928
Years      -163.432940
CAtBat       32.659484
CHits        55.742749
CHmRun       98.992985
CRuns        70.353720
CRBI         90.929778
CWalks       61.228717
LeagueN     -12.522949
DivisionW   -76.066629
PutOuts      47.064574
Assists      12.674980
Errors      -41.573517
NewLeagueN   39.637213

, , 14 comps

                Salary
AtBat       -66.550588
Hits        -20.213068
HmRun       -66.339828
Runs         76.120546
RBI          43.287033
Walks       135.625420
Years      -184.350168
CAtBat       78.872226
CHits       150.229310
CHmRun      105.635149
CRuns       114.000596
CRBI        157.542071
CWalks     -196.022740
LeagueN      -2.180342
DivisionW   -78.940597
PutOuts      49.088085
Assists      45.725246
Errors      -52.227274
NewLeagueN   30.622401

, , 15 comps

                Salary
AtBat      -121.459780
Hits        -23.002074
HmRun      -104.458650
Runs        126.565793
RBI          98.101331
Walks       113.753579
Years      -171.211964
CAtBat       59.519948
CHits       131.168938
CHmRun      112.956111
CRuns       110.476793
CRBI        161.475074
CWalks     -173.432411
LeagueN      -4.865856
DivisionW   -74.502925
PutOuts      53.837079
Assists      58.553401
Errors      -54.760750
NewLeagueN   35.701506

, , 16 comps

               Salary
AtBat      -328.08385
Hits        250.93610
HmRun       -34.58653
Runs         53.54866
RBI          19.59952
Walks       147.05938
Years      -157.02262
CAtBat       18.31693
CHits       172.63981
CHmRun      117.45729
CRuns        61.33616
CRBI        190.78503
CWalks     -173.15364
LeagueN     -17.29380
DivisionW   -74.85403
PutOuts      56.93537
Assists      73.15221
Errors      -52.93703
NewLeagueN   44.86176

, , 17 comps

               Salary
AtBat      -351.55177
Hits        292.17572
HmRun       -52.72531
Runs        -14.83650
RBI          66.80566
Walks       163.83242
Years      -132.13606
CAtBat      -31.92205
CHits       156.06779
CHmRun      215.40176
CRuns       301.02633
CRBI        -50.05894
CWalks     -227.25468
LeagueN     -13.50245
DivisionW   -67.27012
PutOuts      63.98341
Assists      73.34561
Errors      -52.83522
NewLeagueN   42.24517

, , 18 comps

               Salary
AtBat      -288.70379
Hits        266.95959
HmRun       -21.34636
Runs        -40.87854
RBI          34.80951
Walks       154.59900
Years       -76.13620
CAtBat     -435.82608
CHits       170.25965
CHmRun       75.55242
CRuns       527.01922
CRBI        195.52997
CWalks     -230.84672
LeagueN     -13.03671
DivisionW   -64.50601
PutOuts      62.00105
Assists      79.54987
Errors      -52.31389
NewLeagueN   45.43185

, , 19 comps

               Salary
AtBat      -281.30006
Hits        253.50186
HmRun       -24.77878
Runs        -33.71295
RBI          38.63129
Walks       151.76043
Years       -75.83429
CAtBat     -479.63750
CHits       257.56892
CHmRun       94.05591
CRuns       489.46102
CRBI        161.92491
CWalks     -218.86125
LeagueN     -12.18060
DivisionW   -64.12921
PutOuts      61.82955
Assists      80.63960
Errors      -53.17173
NewLeagueN   44.71078</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pcr <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">RMSEP</span>(salary.pcr, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pcr <span class="co"># 348.3224</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 343.3036</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pcr <span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(salary.pcr, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pcr <span class="co"># 14 comps (sans compter l'intercept)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>16 comps 
      17 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 3 --------------------------------------------------------------</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>salary.pls <span class="ot">=</span> <span class="fu">plsr</span>(Salary <span class="sc">~</span>., <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> df_train, <span class="at">validation =</span> <span class="st">"CV"</span>, <span class="at">segments=</span><span class="dv">10</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salary.pls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 197 19 
    Y dimension: 197 1
Fit method: kernelpls
Number of components considered: 19

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV           480.9    358.5    357.8    353.7    352.7    353.8    350.3
adjCV        480.9    358.0    356.2    352.7    351.3    351.4    348.0
       7 comps  8 comps  9 comps  10 comps  11 comps  12 comps  13 comps
CV       345.3    342.5    344.9     347.1     343.3     345.0     346.1
adjCV    343.3    340.3    342.7     344.4     340.9     342.6     343.5
       14 comps  15 comps  16 comps  17 comps  18 comps  19 comps
CV        345.5     344.8     345.3     345.7     344.9     347.1
adjCV     342.9     342.3     342.8     343.1     342.4     344.5

TRAINING: % variance explained
        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps  8 comps
X         40.40    48.72    61.75    72.99    77.54    84.95    89.01    90.49
Salary    47.51    51.90    53.48    55.13    57.67    58.38    58.99    59.99
        9 comps  10 comps  11 comps  12 comps  13 comps  14 comps  15 comps
X         93.83     94.97     96.10     97.86     98.49     98.72     99.10
Salary    60.15     60.51     60.81     60.92     61.01     61.17     61.22
        16 comps  17 comps  18 comps  19 comps
X          99.52     99.79     99.99    100.00
Salary     61.24     61.26     61.27     61.27</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pls, <span class="at">val.type =</span> <span class="st">"RMSEP"</span>) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pls, <span class="at">val.type =</span> <span class="st">"MSEP"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># validationplot(salary.pls, val.type = "R2") # inutile car augment tout le temps en fonction des composantes </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>salary.pls<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1 comps

                Salary
AtBat       26.9353756
Hits        29.0914017
HmRun       21.5813895
Runs        28.4189606
RBI         30.1156112
Walks       31.0681581
Years       26.2379015
CAtBat      36.1229141
CHits       37.9113655
CHmRun      37.4079931
CRuns       39.5445512
CRBI        39.1182351
CWalks      34.7580902
LeagueN     -0.3538253
DivisionW  -16.0742750
PutOuts     17.8380872
Assists      3.7400855
Errors       1.2864800
NewLeagueN   0.4454052

, , 2 comps

                Salary
AtBat       19.8233405
Hits        39.2961212
HmRun        0.3623952
Runs        37.3164931
RBI         27.5572930
Walks       57.7728412
Years       -4.0247254
CAtBat      27.5421019
CHits       39.2468739
CHmRun      45.0188839
CRuns       44.9073707
CRBI        43.9553483
CWalks      26.2578367
LeagueN     30.4933346
DivisionW  -69.6016504
PutOuts     46.5242570
Assists      2.3099920
Errors     -19.3446993
NewLeagueN  33.9449685

, , 3 comps

               Salary
AtBat       -3.037829
Hits        38.411405
HmRun      -27.771874
Runs        32.777154
RBI         15.671191
Walks       65.943071
Years      -25.771207
CAtBat      27.872559
CHits       51.591750
CHmRun      63.088518
CRuns       60.202210
CRBI        59.989673
CWalks      17.376764
LeagueN     18.349990
DivisionW  -92.750869
PutOuts     51.838510
Assists      5.622295
Errors     -40.244363
NewLeagueN  25.141098

, , 4 comps

               Salary
AtBat       -19.38728
Hits         57.46942
HmRun       -54.64517
Runs         42.85148
RBI          16.70187
Walks        84.15661
Years       -74.43326
CAtBat       17.98770
CHits        61.92724
CHmRun       84.12405
CRuns        74.20679
CRBI         76.43975
CWalks      -12.57745
LeagueN      -4.85374
DivisionW  -103.58380
PutOuts      59.78793
Assists      26.98258
Errors      -49.99876
NewLeagueN    8.51758

, , 5 comps

                 Salary
AtBat       -73.7227204
Hits         82.7457469
HmRun       -95.5746723
Runs         40.8414896
RBI          24.0074687
Walks        96.5482302
Years      -158.2133932
CAtBat        9.1105255
CHits        97.6294411
CHmRun      142.4006485
CRuns       112.5068728
CRBI        126.4148329
CWalks      -78.6915093
LeagueN      -0.2756901
DivisionW   -69.9480646
PutOuts      62.6367002
Assists      63.8103365
Errors      -55.1459097
NewLeagueN   28.5507885

, , 6 comps

                 Salary
AtBat      -100.4713814
Hits         90.5896473
HmRun       -86.3779566
Runs         43.3738605
RBI          39.2909203
Walks        98.9001654
Years      -183.1740922
CAtBat        0.8231578
CHits       107.3328161
CHmRun      161.6217181
CRuns       123.7708948
CRBI        140.6508642
CWalks     -108.2937029
LeagueN      -3.1651519
DivisionW   -65.4156052
PutOuts      58.4016492
Assists      53.4171538
Errors      -67.5903485
NewLeagueN   32.0798954

, , 7 comps

                Salary
AtBat      -146.172558
Hits        102.494162
HmRun       -75.753649
Runs         46.219584
RBI          54.794308
Walks       103.218799
Years      -186.520833
CAtBat       -6.045389
CHits       127.605374
CHmRun      159.890703
CRuns       144.729442
CRBI        147.626306
CWalks     -147.051475
LeagueN      -7.358452
DivisionW   -84.361986
PutOuts      40.367850
Assists      60.081719
Errors      -50.614353
NewLeagueN   38.743684

, , 8 comps

               Salary
AtBat      -252.33160
Hits        134.13418
HmRun       -66.82281
Runs         58.05549
RBI          69.45178
Walks       148.76149
Years      -163.66342
CAtBat      -24.65747
CHits       171.98957
CHmRun      123.03494
CRuns       193.46954
CRBI        144.58098
CWalks     -217.81305
LeagueN     -24.32122
DivisionW   -74.68196
PutOuts      63.76183
Assists      57.56840
Errors      -38.28244
NewLeagueN   49.53697

, , 9 comps

               Salary
AtBat      -269.41556
Hits        152.97906
HmRun       -65.39652
Runs         61.01308
RBI          67.35076
Walks       159.27169
Years      -155.54782
CAtBat      -36.01509
CHits       177.06447
CHmRun      116.91509
CRuns       206.99727
CRBI        138.85059
CWalks     -223.79040
LeagueN     -20.67659
DivisionW   -70.08482
PutOuts      51.43532
Assists      64.10520
Errors      -51.25288
NewLeagueN   50.87179

, , 10 comps

                Salary
AtBat      -316.468519
Hits        215.485167
HmRun       -39.725024
Runs         37.856356
RBI          59.107640
Walks       151.202591
Years      -128.575153
CAtBat      -90.136349
CHits       178.237594
CHmRun      125.658776
CRuns       247.666030
CRBI        121.206697
CWalks     -229.306146
LeagueN      -6.178706
DivisionW   -69.875533
PutOuts      64.088767
Assists      98.078355
Errors      -73.707605
NewLeagueN   38.175093

, , 11 comps

                 Salary
AtBat      -356.8707979
Hits        280.8913981
HmRun       -29.8608890
Runs          9.6923805
RBI          39.9092461
Walks       163.3174322
Years      -115.0688597
CAtBat     -161.5057900
CHits       171.1970377
CHmRun      147.8075296
CRuns       297.5757211
CRBI        102.4921336
CWalks     -212.5724165
LeagueN       0.2739336
DivisionW   -66.7711824
PutOuts      62.7717261
Assists      87.2071308
Errors      -54.1110122
NewLeagueN   30.1309932

, , 12 comps

                Salary
AtBat      -359.105420
Hits        314.396259
HmRun       -35.693741
Runs         -4.366186
RBI          35.940724
Walks       154.179734
Years      -106.730098
CAtBat     -188.828072
CHits       174.115098
CHmRun      149.478644
CRuns       322.723033
CRBI         95.886943
CWalks     -214.748216
LeagueN      -4.942140
DivisionW   -67.053774
PutOuts      63.449736
Assists      75.487391
Errors      -49.977351
NewLeagueN   35.241054

, , 13 comps

               Salary
AtBat      -349.25966
Hits        319.32436
HmRun       -29.33053
Runs        -35.50881
RBI          40.83683
Walks       161.55809
Years      -104.10725
CAtBat     -227.51215
CHits       176.56672
CHmRun      145.90453
CRuns       362.54096
CRBI         89.07677
CWalks     -213.31731
LeagueN     -26.38824
DivisionW   -67.04922
PutOuts      62.12044
Assists      79.01766
Errors      -52.68239
NewLeagueN   55.80084

, , 14 comps

               Salary
AtBat      -307.65292
Hits        287.65919
HmRun       -18.92452
Runs        -52.17903
RBI          36.12637
Walks       160.48603
Years      -104.78826
CAtBat     -316.94308
CHits       192.01962
CHmRun      123.20659
CRuns       479.82066
CRBI         83.86492
CWalks     -230.85872
LeagueN     -12.66552
DivisionW   -64.93059
PutOuts      63.05662
Assists      75.27033
Errors      -52.32518
NewLeagueN   43.46205

, , 15 comps

                Salary
AtBat      -294.326632
Hits        270.210684
HmRun       -31.777939
Runs        -50.252383
RBI          48.862272
Walks       163.516423
Years       -82.049050
CAtBat     -367.163642
CHits       186.686888
CHmRun      125.246726
CRuns       506.465145
CRBI         99.604613
CWalks     -242.437510
LeagueN      -8.774019
DivisionW   -64.417660
PutOuts      62.503576
Assists      76.951380
Errors      -52.460603
NewLeagueN   40.121254

, , 16 comps

               Salary
AtBat      -294.84456
Hits        262.30280
HmRun       -32.60577
Runs        -34.70186
RBI          48.09637
Walks       154.27545
Years       -78.00604
CAtBat     -397.02734
CHits       186.27429
CHmRun      117.88323
CRuns       517.22199
CRBI        117.23509
CWalks     -234.88174
LeagueN     -14.49323
DivisionW   -63.64453
PutOuts      63.59394
Assists      79.82276
Errors      -52.67686
NewLeagueN   47.24134

, , 17 comps

               Salary
AtBat      -293.20458
Hits        261.08796
HmRun       -31.72453
Runs        -36.72746
RBI          52.25094
Walks       150.72884
Years       -79.76772
CAtBat     -432.45753
CHits       196.11082
CHmRun       92.36781
CRuns       517.73233
CRBI        155.47543
CWalks     -222.46696
LeagueN     -11.71791
DivisionW   -63.33364
PutOuts      62.91382
Assists      80.20418
Errors      -53.04287
NewLeagueN   44.09811

, , 18 comps

               Salary
AtBat      -285.52859
Hits        261.52483
HmRun       -22.54761
Runs        -38.06879
RBI          36.10966
Walks       153.44135
Years       -75.85029
CAtBat     -454.55716
CHits       205.05771
CHmRun       82.32316
CRuns       512.55572
CRBI        183.29992
CWalks     -226.05553
LeagueN     -12.70183
DivisionW   -64.35903
PutOuts      61.91573
Assists      80.00163
Errors      -52.65145
NewLeagueN   45.16044

, , 19 comps

               Salary
AtBat      -281.30006
Hits        253.50186
HmRun       -24.77878
Runs        -33.71295
RBI          38.63129
Walks       151.76043
Years       -75.83429
CAtBat     -479.63750
CHits       257.56892
CHmRun       94.05591
CRuns       489.46102
CRBI        161.92491
CWalks     -218.86125
LeagueN     -12.18060
DivisionW   -64.12921
PutOuts      61.82955
Assists      80.63960
Errors      -53.17173
NewLeagueN   44.71078</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pls <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">RMSEP</span>(salary.pls, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pls <span class="co"># 348.3051</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 342.4799</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pls <span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(salary.pls, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pls <span class="co"># 12 comps (sans compter l'intercept)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>8 comps 
      9 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 4 --------------------------------------------------------------</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul à la main entre la prdiction et le df_test</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pcr <span class="ot">=</span> <span class="fu">predict</span>(salary.pcr, df_test)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pcr <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 346.2538</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 346.1988</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pls <span class="ot">=</span> <span class="fu">predict</span>(salary.pls, df_test)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pls <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 359.1725</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 356.0666</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Le rmsep est minimum pour PCR sur les 3 méthodes (PCR-&gt;PLS-&gt;step)</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 5 --------------------------------------------------------------</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># refaire les méthodes en faisant le 10-fold 100 fois </span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>res.pcr <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modele PCR</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  pcr.fit <span class="ot">=</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">subset =</span> indices_train,</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">segments =</span> <span class="dv">10</span>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RMSEP</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  RMSEP.cv <span class="ot">=</span> <span class="fu">RMSEP</span>(pcr.fit,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,]</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On stocke les resultats</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  res.pcr <span class="ot">=</span> <span class="fu">cbind</span>(res.pcr, RMSEP.cv)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pcr, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PCR avec CV"</span>)</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co"># On regarde le RMSEP moyen que l'on peut obternir </span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co"># pour 100 decoupages différents de notre jeu de données</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>pcr.mean.cv <span class="ot">=</span> <span class="fu">apply</span>(res.pcr, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> mean) <span class="co"># for a matrix 1 indicates rows</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pcr.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-15-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(pcr.mean.cv) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>16 comps 
      17 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(pcr.fit, <span class="at">ncomp =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , 5 comps

               Salary
AtBat       27.694268
Hits        29.646194
HmRun       25.730261
Runs        33.481790
RBI         33.235304
Walks       37.877679
Years       24.820145
CAtBat      32.238744
CHits       33.201307
CHmRun      33.599843
CRuns       37.075568
CRBI        33.728773
CWalks      38.302157
LeagueN     24.734546
DivisionW  -73.675797
PutOuts     11.097175
Assists     -6.114206
Errors      -7.340447
NewLeagueN  23.574869</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>res.pls <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modele PCR</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  pls.fit <span class="ot">=</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">subset =</span> indices_train,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">segments =</span> <span class="dv">10</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RMSEP</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  RMSEP.cv <span class="ot">=</span> <span class="fu">RMSEP</span>(pls.fit,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,]</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On stocke les resultats</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  res.pls <span class="ot">=</span> <span class="fu">cbind</span>(res.pls, RMSEP.cv)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pls, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PLS avec CV"</span>)</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>pls.mean.cv <span class="ot">=</span> <span class="fu">apply</span>(res.pls, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> mean) </span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pls.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-15-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(pls.mean.cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>8 comps 
      9 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(pls.fit, <span class="at">ncomp =</span> <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , 9 comps

               Salary
AtBat      -269.41556
Hits        152.97906
HmRun       -65.39652
Runs         61.01308
RBI          67.35076
Walks       159.27169
Years      -155.54782
CAtBat      -36.01509
CHits       177.06447
CHmRun      116.91509
CRuns       206.99727
CRBI        138.85059
CWalks     -223.79040
LeagueN     -20.67659
DivisionW   -70.08482
PutOuts      51.43532
Assists      64.10520
Errors      -51.25288
NewLeagueN   50.87179</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pcr, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PCR"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pcr.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">which.min</span>(pcr.mean.cv) )</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pls, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PLS"</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pls.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">which.min</span>(pls.mean.cv) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Exercice_06_files/figure-html/unnamed-chunk-15-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 6 --------------------------------------------------------------</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Faire modèles finaux avec ncomp= which.min(ncomp)</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>pcr.fit_final <span class="ot">=</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> df, </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncomp =</span> <span class="fu">which.min</span>(pcr.mean.cv)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">subset =</span> indices_train,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">segments =</span> <span class="dv">10</span> )</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>pls.fit_final <span class="ot">=</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> df, </span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncomp =</span> <span class="fu">which.min</span>(pls.mean.cv)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">subset =</span> indices_train,</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">segments =</span> <span class="dv">10</span> )</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pcr.fit_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 197 19 
    Y dimension: 197 1
Fit method: svdpc
Number of components considered: 16

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV           480.9    357.9    361.5    362.4    361.0    355.4    359.9
adjCV        480.9    357.6    361.0    361.8    360.2    354.5    358.8
       7 comps  8 comps  9 comps  10 comps  11 comps  12 comps  13 comps
CV       359.3    361.9    363.1     353.0     353.7     353.3     353.9
adjCV    358.1    360.5    361.7     351.4     352.3     351.8     352.8
       14 comps  15 comps  16 comps
CV        345.4     347.6     343.9
adjCV     343.4     345.6     341.7

TRAINING: % variance explained
        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps  8 comps
X         40.51    60.57    71.15    79.89    85.15    89.29    92.85    95.30
Salary    45.77    45.85    46.38    47.72    49.65    50.36    50.76    50.76
        9 comps  10 comps  11 comps  12 comps  13 comps  14 comps  15 comps
X         96.53     97.46     98.13     98.74     99.16     99.51     99.77
Salary    51.02     53.82     54.07     54.25     54.60     58.06     58.32
        16 comps
X          99.90
Salary     59.87</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">RMSEP</span>(pcr.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 343.9382</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  356.9369</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(<span class="fu">RMSEP</span>(pcr.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>16 comps 
      17 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 18 comps</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pls.fit_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 197 19 
    Y dimension: 197 1
Fit method: kernelpls
Number of components considered: 8

VALIDATION: RMSEP
Cross-validated using 10 random segments.
       (Intercept)  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps
CV           480.9    357.2    365.0      354    359.6    360.8    356.9
adjCV        480.9    356.8    362.7      353    358.1    357.9    354.0
       7 comps  8 comps
CV       351.5    345.4
adjCV    349.2    343.0

TRAINING: % variance explained
        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps  8 comps
X         40.40    48.72    61.75    72.99    77.54    84.95    89.01    90.49
Salary    47.51    51.90    53.48    55.13    57.67    58.38    58.99    59.99</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">RMSEP</span>(pls.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 345.3908</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 352.8074</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(<span class="fu">RMSEP</span>(pls.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>8 comps 
      9 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 comps</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 7 (4bis) --------------------------------------------------------------</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul à la main entre la prdiction et le df_test</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>rmsep_mod.step</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): objet 'rmsep_mod.step' introuvable</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 357.7089</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pcr <span class="ot">=</span> <span class="fu">predict</span>(pcr.fit_final, df_test)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pcr <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 343.2151</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 312.8734</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pls <span class="ot">=</span> <span class="fu">predict</span>(pls.fit_final, df_test)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pls <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 355.1609</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 315.9921</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Le rmsep est minimum pour PCR sur les 3 méthodes (PCR-&gt;PLS----&gt;step)</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="do">## FAIRE UNE BELLE CONCLUSION  SUR CHOIX DE MODELE EN GARDANT UN ESPRIT CRITIQUE </span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"># LE MODELE STEP N'EST PAS SI MAL CAR NE CONTIENT QUE 3 VAR ET ON EST SUR UN JEU DE DONNEES AVEC NA </span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># DONC PCR ET PLS PREND TOUT LES VAR POUR PRED MAIS NA PEUVENT IMPACTER</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb87" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Exercice 06"</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Clément Poupelin"</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: false</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: article</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> false</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ["Régression sur composantes principales", "Régression des moindres carrés partiels", "Validation croisée"]</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "/img/baseball.png"</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Ici, on continu sur des données de baseball en mettant en pratique les techniques de PCR et PLS avec de la validation croisée"</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Intervenant.e.s</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rédaction</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Clément Poupelin**, <span class="co">[</span><span class="ot">clementjc.poupelin\@gmail.com</span><span class="co">](mailto:clementjc.poupelin@gmail.com)</span>{.email}\</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relecture</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Rappels sur PCR et PLS</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>Dans l’analyse des données et la modélisation statistique, la régression linéaire classique peut être limitée lorsque les variables explicatives sont fortement corrélées (problème de colinéarité) ou lorsque leur nombre est supérieur au nombre d’observations (problème de haute dimensionnalité). Pour remédier à ces défis, des méthodes de réduction de dimensionnalité comme la Régression sur Composantes Principales (PCR) et la Régression des Moindres Carrés Partiels (PLS) sont utilisées.</span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## PCR</span></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>Régression sur Composantes Principales (PCR)</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>La PCR repose sur une Analyse en Composantes Principales (ACP) pour transformer les variables explicatives en nouvelles variables orthogonales appelées composantes principales. Seules les premières composantes, capturant le plus de variance, sont conservées dans la régression. Cette approche permet de réduire la multicolinéarité et d’éviter le sur-ajustement en limitant la complexité du modèle. Cependant, la PCR ne prend pas en compte la relation entre les variables explicatives et la variable réponse lors de la sélection des composantes.</span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## PLS </span></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>Régression des Moindres Carrés Partiels (PLS)</span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>Contrairement à la PCR, la PLS cherche à maximiser la covariance entre les variables explicatives et la variable réponse. Elle construit des composantes latentes qui capturent non seulement la variance des variables explicatives mais aussi leur corrélation avec la variable à prédire. Cette méthode est souvent plus efficace que la PCR pour les problèmes de prédiction, car elle optimise directement la relation entre les prédicteurs et la réponse.</span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a>En résumé, la PCR est une approche basée sur la variance des prédicteurs, tandis que la PLS optimise la relation entre les prédicteurs et la réponse. Le choix entre ces deux méthodes dépend du contexte : la PCR est utile pour la réduction de dimensionnalité, tandis que la PLS est souvent plus performante pour la prédiction</span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-65"><a href="#cb87-65" aria-hidden="true" tabindex="-1"></a>:::: panel-tabset</span>
<span id="cb87-66"><a href="#cb87-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages</span></span>
<span id="cb87-67"><a href="#cb87-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-68"><a href="#cb87-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, setup, warning=FALSE, message=FALSE}</span></span>
<span id="cb87-69"><a href="#cb87-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Données</span></span>
<span id="cb87-70"><a href="#cb87-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)         <span class="co"># Hitters data </span></span>
<span id="cb87-71"><a href="#cb87-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)        <span class="co"># manipulation des données</span></span>
<span id="cb87-72"><a href="#cb87-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-73"><a href="#cb87-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Infrence</span></span>
<span id="cb87-74"><a href="#cb87-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls) <span class="do">## PCR et PLS</span></span>
<span id="cb87-75"><a href="#cb87-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-76"><a href="#cb87-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-77"><a href="#cb87-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb87-78"><a href="#cb87-78" aria-hidden="true" tabindex="-1"></a><span class="do">## ggplot</span></span>
<span id="cb87-79"><a href="#cb87-79" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb87-80"><a href="#cb87-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb87-81"><a href="#cb87-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-82"><a href="#cb87-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-83"><a href="#cb87-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fonctions</span></span>
<span id="cb87-84"><a href="#cb87-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-85"><a href="#cb87-85" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb87-86"><a href="#cb87-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-87"><a href="#cb87-87" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot de validation</span></span>
<span id="cb87-88"><a href="#cb87-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-91"><a href="#cb87-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-92"><a href="#cb87-92" aria-hidden="true" tabindex="-1"></a>my_validationplot <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, data) {</span>
<span id="cb87-93"><a href="#cb87-93" aria-hidden="true" tabindex="-1"></a>  msep.cv <span class="ot">&lt;-</span> <span class="fu">MSEP</span>(mod, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>, <span class="st">"adjCV"</span>))</span>
<span id="cb87-94"><a href="#cb87-94" aria-hidden="true" tabindex="-1"></a>  rmsep.cv <span class="ot">&lt;-</span> <span class="fu">RMSEP</span>(mod, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>, <span class="st">"adjCV"</span>))</span>
<span id="cb87-95"><a href="#cb87-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-96"><a href="#cb87-96" aria-hidden="true" tabindex="-1"></a>  x_msep <span class="ot">&lt;-</span> <span class="fu">c</span>(msep.cv<span class="sc">$</span>val[<span class="dv">1</span>, , ], msep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])</span>
<span id="cb87-97"><a href="#cb87-97" aria-hidden="true" tabindex="-1"></a>  x_rmsep <span class="ot">&lt;-</span> <span class="fu">c</span>(rmsep.cv<span class="sc">$</span>val[<span class="dv">1</span>, , ], rmsep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])</span>
<span id="cb87-98"><a href="#cb87-98" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"CV"</span>, <span class="fu">length</span>(msep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])), <span class="fu">rep</span>(<span class="st">"adjCV"</span>, <span class="fu">length</span>(msep.cv<span class="sc">$</span>val[<span class="dv">2</span>, , ])))</span>
<span id="cb87-99"><a href="#cb87-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-100"><a href="#cb87-100" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">ncol</span>(data) <span class="sc">-</span> <span class="dv">1</span>), <span class="dv">0</span><span class="sc">:</span>(<span class="fu">ncol</span>(data) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb87-101"><a href="#cb87-101" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x_msep, x_rmsep, y, z)</span>
<span id="cb87-102"><a href="#cb87-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(dt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MSEP"</span>, <span class="st">"RMSEP"</span>, <span class="st">"sample"</span>, <span class="st">"comps"</span>)</span>
<span id="cb87-103"><a href="#cb87-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-104"><a href="#cb87-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-105"><a href="#cb87-105" aria-hidden="true" tabindex="-1"></a>  p.msep <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dt, <span class="fu">aes</span>(<span class="at">x =</span> comps, <span class="at">y =</span> MSEP, <span class="at">col =</span> sample)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb87-106"><a href="#cb87-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb87-107"><a href="#cb87-107" aria-hidden="true" tabindex="-1"></a>  p.rmsep <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dt, <span class="fu">aes</span>(<span class="at">x =</span> comps, <span class="at">y =</span> RMSEP, <span class="at">col =</span> sample)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb87-108"><a href="#cb87-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb87-109"><a href="#cb87-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-110"><a href="#cb87-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">MSEP =</span> p.msep, <span class="at">RMSEP =</span> p.rmsep))</span>
<span id="cb87-111"><a href="#cb87-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-112"><a href="#cb87-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-113"><a href="#cb87-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-114"><a href="#cb87-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-115"><a href="#cb87-115" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-116"><a href="#cb87-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-117"><a href="#cb87-117" aria-hidden="true" tabindex="-1"></a><span class="fu">## Seed</span></span>
<span id="cb87-118"><a href="#cb87-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-121"><a href="#cb87-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-122"><a href="#cb87-122" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">140400</span>)</span>
<span id="cb87-123"><a href="#cb87-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-124"><a href="#cb87-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-125"><a href="#cb87-125" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb87-126"><a href="#cb87-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-127"><a href="#cb87-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-128"><a href="#cb87-128" aria-hidden="true" tabindex="-1"></a><span class="fu"># Données</span></span>
<span id="cb87-129"><a href="#cb87-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-130"><a href="#cb87-130" aria-hidden="true" tabindex="-1"></a>On étudie à nouveau le jeu de données <span class="co">[</span><span class="ot">**Hitters**</span><span class="co">](https://rdrr.io/cran/ISLR/man/Hitters.html)</span> disponible dans la libraire *`{ISLR}`* de *`R`*. Il s'agit d'un jeu de données de la *Major League Baseball* provenant des saisons de 1986 et 1987.</span>
<span id="cb87-131"><a href="#cb87-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-132"><a href="#cb87-132" aria-hidden="true" tabindex="-1"></a>Le jeu de données possède <span class="in">`r dim(Hitters)[1]`</span> lignes/individus pour les différents joueurs et <span class="in">`r dim(Hitters)[2]`</span> variables.\</span>
<span id="cb87-133"><a href="#cb87-133" aria-hidden="true" tabindex="-1"></a>Parmi les variables, on trouve les informations suivantes :</span>
<span id="cb87-134"><a href="#cb87-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-135"><a href="#cb87-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb87-136"><a href="#cb87-136" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb87-137"><a href="#cb87-137" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb87-138"><a href="#cb87-138" aria-hidden="true" tabindex="-1"></a>identity_keys <span class="ot">&lt;-</span> <span class="fu">cell_spec</span>(</span>
<span id="cb87-139"><a href="#cb87-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">colnames</span>(Hitters), <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-140"><a href="#cb87-140" aria-hidden="true" tabindex="-1"></a>identity_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Number of times at bat in 1986"</span>, <span class="st">"Number of hits in 1986"</span>, <span class="st">"Number of home runs in 1986"</span>, <span class="st">"Number of runs in 1986"</span>, <span class="st">"Number of runs batted in in 1986"</span>, <span class="st">"Number of walks in 1986"</span>, <span class="st">"Number of years in the major leagues"</span>, <span class="st">"Number of times at bat during his career"</span>, <span class="st">"Number of hits during his career"</span>, <span class="st">"Number of home runs during his career"</span>, <span class="st">"Number of runs during his career"</span>, <span class="st">"Number of runs batted in during his career"</span>, <span class="st">"Number of walks during his career"</span>, <span class="st">"A factor with levels A and N indicating player's league at the end of 1986"</span>, <span class="st">"A factor with levels E and W indicating player's division at the end of 1986"</span>, <span class="st">"Number of put outs in 1986"</span>, <span class="st">"Number of assists in 1986"</span>, <span class="st">"Number of errors in 1986"</span>, <span class="st">"1987 annual salary on opening day in thousands of dollars"</span>, <span class="st">"A factor with levels A and N indicating player's league at the beginning of 1987"</span>)</span>
<span id="cb87-141"><a href="#cb87-141" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb87-142"><a href="#cb87-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">keys =</span> identity_keys, </span>
<span id="cb87-143"><a href="#cb87-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">values =</span> identity_values, </span>
<span id="cb87-144"><a href="#cb87-144" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-145"><a href="#cb87-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(</span>
<span id="cb87-146"><a href="#cb87-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb87-147"><a href="#cb87-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-148"><a href="#cb87-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>, </span>
<span id="cb87-149"><a href="#cb87-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="cn">NULL</span></span>
<span id="cb87-150"><a href="#cb87-150" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb87-151"><a href="#cb87-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb87-152"><a href="#cb87-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-153"><a href="#cb87-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-154"><a href="#cb87-154" aria-hidden="true" tabindex="-1"></a>Comme pour l'<span class="co">[</span><span class="ot">Exercice 1</span><span class="co">](../posts/Exercice_01.qmd)</span>, on va commencer par se débarasser des variables manquantes.</span>
<span id="cb87-155"><a href="#cb87-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-158"><a href="#cb87-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-159"><a href="#cb87-159" aria-hidden="true" tabindex="-1"></a>Hitters_Without_NA <span class="ot">&lt;-</span> Hitters <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb87-160"><a href="#cb87-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-161"><a href="#cb87-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-162"><a href="#cb87-162" aria-hidden="true" tabindex="-1"></a>Comme cela fait maintenant plusieurs fois que l'on fait affaire à ce jeu de données, on se passera des analyses descritpives faites en <span class="co">[</span><span class="ot">Exercice 1</span><span class="co">](../posts/Exercice_01.qmd)</span>.</span>
<span id="cb87-163"><a href="#cb87-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-164"><a href="#cb87-164" aria-hidden="true" tabindex="-1"></a>Ainsi, on va pouvoir tout de suite commencer par faire le découpage de notre jeu de données en échantillon *train* et *test*. Le jeu de données *train* contiendra 3/4 des individus sans valeurs manquantes de Hitters, tirés aléatoirement. Le reste du jeu de données composera l’échantillon *test*.</span>
<span id="cb87-165"><a href="#cb87-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-168"><a href="#cb87-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-169"><a href="#cb87-169" aria-hidden="true" tabindex="-1"></a>percent_to_draw <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb87-170"><a href="#cb87-170" aria-hidden="true" tabindex="-1"></a>index_train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(Hitters_Without_NA), <span class="at">size =</span> <span class="fu">floor</span>(percent_to_draw <span class="sc">*</span> <span class="fu">nrow</span>(Hitters_Without_NA)))</span>
<span id="cb87-171"><a href="#cb87-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-172"><a href="#cb87-172" aria-hidden="true" tabindex="-1"></a>Hitters_train <span class="ot">&lt;-</span> Hitters_Without_NA[index_train, ]</span>
<span id="cb87-173"><a href="#cb87-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-174"><a href="#cb87-174" aria-hidden="true" tabindex="-1"></a>Hitters_test <span class="ot">&lt;-</span> Hitters_Without_NA[<span class="sc">-</span>index_train, ]</span>
<span id="cb87-175"><a href="#cb87-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-176"><a href="#cb87-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-177"><a href="#cb87-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-178"><a href="#cb87-178" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analyse Inférentielle</span></span>
<span id="cb87-179"><a href="#cb87-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-180"><a href="#cb87-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-181"><a href="#cb87-181" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb87-182"><a href="#cb87-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-183"><a href="#cb87-183" aria-hidden="true" tabindex="-1"></a><span class="fu">## PCR</span></span>
<span id="cb87-184"><a href="#cb87-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-187"><a href="#cb87-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-188"><a href="#cb87-188" aria-hidden="true" tabindex="-1"></a>mod_pcr <span class="ot">&lt;-</span> <span class="fu">pcr</span>(</span>
<span id="cb87-189"><a href="#cb87-189" aria-hidden="true" tabindex="-1"></a>  Salary <span class="sc">~</span> .,</span>
<span id="cb87-190"><a href="#cb87-190" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-191"><a href="#cb87-191" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Hitters_train,</span>
<span id="cb87-192"><a href="#cb87-192" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb87-193"><a href="#cb87-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">segments =</span> <span class="dv">10</span></span>
<span id="cb87-194"><a href="#cb87-194" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-195"><a href="#cb87-195" aria-hidden="true" tabindex="-1"></a>mod_pcr <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb87-196"><a href="#cb87-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-197"><a href="#cb87-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-198"><a href="#cb87-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-199"><a href="#cb87-199" aria-hidden="true" tabindex="-1"></a>On peut maintenant visualiser l'évolution du MSEP et RMSEP enfonction du nombre de composantes gardées.</span>
<span id="cb87-200"><a href="#cb87-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=12}</span></span>
<span id="cb87-201"><a href="#cb87-201" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="fu">my_validationplot</span>(mod_pcr, Hitters_train)<span class="sc">$</span>MSEP,</span>
<span id="cb87-202"><a href="#cb87-202" aria-hidden="true" tabindex="-1"></a>             <span class="fu">my_validationplot</span>(mod_pcr, Hitters_train)<span class="sc">$</span>RMSEP,</span>
<span id="cb87-203"><a href="#cb87-203" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb87-204"><a href="#cb87-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-205"><a href="#cb87-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-206"><a href="#cb87-206" aria-hidden="true" tabindex="-1"></a>On peut voir courbe proche entre CV et adjCV avec une valeur minimum qui semble se trouver pour 6 composantes.</span>
<span id="cb87-207"><a href="#cb87-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-208"><a href="#cb87-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-209"><a href="#cb87-209" aria-hidden="true" tabindex="-1"></a>Et on petut alors récupérer le nombre de composantes à garder qui minimsent le MSEP et RMSEP.</span>
<span id="cb87-212"><a href="#cb87-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-213"><a href="#cb87-213" aria-hidden="true" tabindex="-1"></a>ncomp.rmsep_pcr <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(mod_pcr, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>))<span class="sc">$</span>val[<span class="st">"CV"</span>,,])<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb87-214"><a href="#cb87-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-215"><a href="#cb87-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-216"><a href="#cb87-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-217"><a href="#cb87-217" aria-hidden="true" tabindex="-1"></a><span class="fu">## PLS</span></span>
<span id="cb87-218"><a href="#cb87-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-221"><a href="#cb87-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-222"><a href="#cb87-222" aria-hidden="true" tabindex="-1"></a>mod_pls <span class="ot">&lt;-</span> <span class="fu">plsr</span>(</span>
<span id="cb87-223"><a href="#cb87-223" aria-hidden="true" tabindex="-1"></a>  Salary <span class="sc">~</span> .,</span>
<span id="cb87-224"><a href="#cb87-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-225"><a href="#cb87-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Hitters_train,</span>
<span id="cb87-226"><a href="#cb87-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb87-227"><a href="#cb87-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">segments =</span> <span class="dv">10</span></span>
<span id="cb87-228"><a href="#cb87-228" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-229"><a href="#cb87-229" aria-hidden="true" tabindex="-1"></a>mod_pls <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb87-230"><a href="#cb87-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-231"><a href="#cb87-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-232"><a href="#cb87-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-233"><a href="#cb87-233" aria-hidden="true" tabindex="-1"></a>On peut maintenant visualiser l'évolution du MSEP et RMSEP enfonction du nombre de composantes gardées.</span>
<span id="cb87-234"><a href="#cb87-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=12}</span></span>
<span id="cb87-235"><a href="#cb87-235" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="fu">my_validationplot</span>(mod_pls, Hitters_train)<span class="sc">$</span>MSEP,</span>
<span id="cb87-236"><a href="#cb87-236" aria-hidden="true" tabindex="-1"></a>             <span class="fu">my_validationplot</span>(mod_pls, Hitters_train)<span class="sc">$</span>RMSEP,</span>
<span id="cb87-237"><a href="#cb87-237" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb87-238"><a href="#cb87-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-239"><a href="#cb87-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-240"><a href="#cb87-240" aria-hidden="true" tabindex="-1"></a>On peut voir courbe proche entre CV et adjCV avec une valeur minimum qui semble se trouver pour 6 composantes.</span>
<span id="cb87-241"><a href="#cb87-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-242"><a href="#cb87-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-243"><a href="#cb87-243" aria-hidden="true" tabindex="-1"></a>Et on petut alors récupérer le nombre de composantes à garder qui minimsent le MSEP et RMSEP.</span>
<span id="cb87-246"><a href="#cb87-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-247"><a href="#cb87-247" aria-hidden="true" tabindex="-1"></a>ncomp.rmsep_pls <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(mod_pls, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>))<span class="sc">$</span>val[<span class="st">"CV"</span>,,])<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb87-248"><a href="#cb87-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-249"><a href="#cb87-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-250"><a href="#cb87-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-251"><a href="#cb87-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-252"><a href="#cb87-252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-253"><a href="#cb87-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-254"><a href="#cb87-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-255"><a href="#cb87-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-256"><a href="#cb87-256" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prédiction</span></span>
<span id="cb87-257"><a href="#cb87-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-258"><a href="#cb87-258" aria-hidden="true" tabindex="-1"></a>On va calculer le RMSEP calculé à partir de la prédiction pour l'échantillon test.</span>
<span id="cb87-261"><a href="#cb87-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-262"><a href="#cb87-262" aria-hidden="true" tabindex="-1"></a>hat_Hitters_test_mod_pcr <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_pcr, Hitters_test, <span class="at">ncomp =</span>  (<span class="fu">which.min</span>(<span class="fu">RMSEP</span>(</span>
<span id="cb87-263"><a href="#cb87-263" aria-hidden="true" tabindex="-1"></a>  mod_pcr, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>)</span>
<span id="cb87-264"><a href="#cb87-264" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>val[<span class="st">"CV"</span>, , ]) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb87-265"><a href="#cb87-265" aria-hidden="true" tabindex="-1"></a>rmsep_mod_pcr <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((</span>
<span id="cb87-266"><a href="#cb87-266" aria-hidden="true" tabindex="-1"></a>  hat_Hitters_test_mod_pcr <span class="sc">-</span> Hitters_test<span class="sc">$</span>Salary</span>
<span id="cb87-267"><a href="#cb87-267" aria-hidden="true" tabindex="-1"></a>) <span class="sc">**</span> <span class="dv">2</span>))</span>
<span id="cb87-268"><a href="#cb87-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-269"><a href="#cb87-269" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pls <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_pls, Hitters_test, <span class="at">ncomp =</span>  (<span class="fu">which.min</span>(<span class="fu">RMSEP</span>(</span>
<span id="cb87-270"><a href="#cb87-270" aria-hidden="true" tabindex="-1"></a>  mod_pls, <span class="at">estimate =</span> <span class="fu">c</span>(<span class="st">"CV"</span>)</span>
<span id="cb87-271"><a href="#cb87-271" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>val[<span class="st">"CV"</span>, , ]) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb87-272"><a href="#cb87-272" aria-hidden="true" tabindex="-1"></a>rmsep_mod_pls <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((</span>
<span id="cb87-273"><a href="#cb87-273" aria-hidden="true" tabindex="-1"></a>  hat_df_test_salary.pls <span class="sc">-</span> Hitters_test<span class="sc">$</span>Salary</span>
<span id="cb87-274"><a href="#cb87-274" aria-hidden="true" tabindex="-1"></a>) <span class="sc">**</span> <span class="dv">2</span>))</span>
<span id="cb87-275"><a href="#cb87-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-276"><a href="#cb87-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-279"><a href="#cb87-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-280"><a href="#cb87-280" aria-hidden="true" tabindex="-1"></a>rmsep_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"prediction PCR"</span> <span class="ot">=</span> rmsep_mod_pcr, <span class="st">"prediction PLS"</span> <span class="ot">=</span> rmsep_mod_pls) </span>
<span id="cb87-281"><a href="#cb87-281" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rmsep_df) <span class="ot">&lt;-</span> <span class="st">"RMSEP"</span></span>
<span id="cb87-282"><a href="#cb87-282" aria-hidden="true" tabindex="-1"></a>rmsep_df </span>
<span id="cb87-283"><a href="#cb87-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-284"><a href="#cb87-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-285"><a href="#cb87-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-286"><a href="#cb87-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-287"><a href="#cb87-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-288"><a href="#cb87-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-289"><a href="#cb87-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-290"><a href="#cb87-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-291"><a href="#cb87-291" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb87-292"><a href="#cb87-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-293"><a href="#cb87-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-294"><a href="#cb87-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-295"><a href="#cb87-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-296"><a href="#cb87-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-297"><a href="#cb87-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-298"><a href="#cb87-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-299"><a href="#cb87-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-300"><a href="#cb87-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-301"><a href="#cb87-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-302"><a href="#cb87-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-303"><a href="#cb87-303" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session info</span></span>
<span id="cb87-304"><a href="#cb87-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-307"><a href="#cb87-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-308"><a href="#cb87-308" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>(<span class="at">pkgs =</span> <span class="st">"attached"</span>)</span>
<span id="cb87-309"><a href="#cb87-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-310"><a href="#cb87-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-311"><a href="#cb87-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-312"><a href="#cb87-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-313"><a href="#cb87-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-314"><a href="#cb87-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-315"><a href="#cb87-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-316"><a href="#cb87-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-317"><a href="#cb87-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-318"><a href="#cb87-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-319"><a href="#cb87-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-320"><a href="#cb87-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-321"><a href="#cb87-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-322"><a href="#cb87-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-323"><a href="#cb87-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-324"><a href="#cb87-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-325"><a href="#cb87-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE}</span></span>
<span id="cb87-326"><a href="#cb87-326" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">na.omit</span>(Hitters)</span>
<span id="cb87-327"><a href="#cb87-327" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)</span>
<span id="cb87-328"><a href="#cb87-328" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb87-329"><a href="#cb87-329" aria-hidden="true" tabindex="-1"></a>pourcentage_a_tirer <span class="ot">=</span> <span class="fl">0.75</span></span>
<span id="cb87-330"><a href="#cb87-330" aria-hidden="true" tabindex="-1"></a>indices_train <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(df), <span class="at">size =</span> <span class="fu">floor</span>(pourcentage_a_tirer <span class="sc">*</span> <span class="fu">nrow</span>(df)))</span>
<span id="cb87-331"><a href="#cb87-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-332"><a href="#cb87-332" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">=</span> df[indices_train, ]</span>
<span id="cb87-333"><a href="#cb87-333" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_train)</span>
<span id="cb87-334"><a href="#cb87-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-335"><a href="#cb87-335" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">=</span> df[<span class="sc">-</span>indices_train, ] </span>
<span id="cb87-336"><a href="#cb87-336" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_test)</span>
<span id="cb87-337"><a href="#cb87-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-338"><a href="#cb87-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-339"><a href="#cb87-339" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 1.5 --------------------------------------------------------------</span></span>
<span id="cb87-340"><a href="#cb87-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-341"><a href="#cb87-341" aria-hidden="true" tabindex="-1"></a><span class="co"># faire une selec forwise-stepwise avec critere BIC sur train puis rmsep sur test</span></span>
<span id="cb87-342"><a href="#cb87-342" aria-hidden="true" tabindex="-1"></a>mod0<span class="ot">=</span><span class="fu">lm</span>(Salary<span class="sc">~</span><span class="dv">0</span>, <span class="at">data=</span>df_train)</span>
<span id="cb87-343"><a href="#cb87-343" aria-hidden="true" tabindex="-1"></a>mod_full<span class="ot">=</span><span class="fu">lm</span>(Salary<span class="sc">~</span>., <span class="at">data=</span>df_train)</span>
<span id="cb87-344"><a href="#cb87-344" aria-hidden="true" tabindex="-1"></a>mod.step <span class="ot">=</span> <span class="fu">step</span>(mod0, <span class="at">scope =</span> <span class="fu">formula</span>(mod_full), <span class="at">trace =</span> <span class="cn">FALSE</span>, <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">k =</span> <span class="fu">log</span>(n))</span>
<span id="cb87-345"><a href="#cb87-345" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.step)</span>
<span id="cb87-346"><a href="#cb87-346" aria-hidden="true" tabindex="-1"></a><span class="co"># significativité de nos 3 var (CRuns Walks CWalks) + r2 =&gt; mod  pas trop mal</span></span>
<span id="cb87-347"><a href="#cb87-347" aria-hidden="true" tabindex="-1"></a><span class="co"># grosse standard error</span></span>
<span id="cb87-348"><a href="#cb87-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-349"><a href="#cb87-349" aria-hidden="true" tabindex="-1"></a>hat_df_test_mod.step <span class="ot">=</span> <span class="fu">predict</span>(mod.step, df_test)</span>
<span id="cb87-350"><a href="#cb87-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-351"><a href="#cb87-351" aria-hidden="true" tabindex="-1"></a>rmsep_mod.step <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_mod.step <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb87-352"><a href="#cb87-352" aria-hidden="true" tabindex="-1"></a>rmsep_mod.step</span>
<span id="cb87-353"><a href="#cb87-353" aria-hidden="true" tabindex="-1"></a><span class="co"># 357.7089</span></span>
<span id="cb87-354"><a href="#cb87-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-355"><a href="#cb87-355" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 2 --------------------------------------------------------------</span></span>
<span id="cb87-356"><a href="#cb87-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-357"><a href="#cb87-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-358"><a href="#cb87-358" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)</span>
<span id="cb87-359"><a href="#cb87-359" aria-hidden="true" tabindex="-1"></a>salary.pcr <span class="ot">=</span> <span class="fu">pcr</span>(Salary <span class="sc">~</span>., <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> df_train, <span class="at">validation =</span> <span class="st">"CV"</span>, <span class="at">segments=</span><span class="dv">10</span>)</span>
<span id="cb87-360"><a href="#cb87-360" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salary.pcr)</span>
<span id="cb87-361"><a href="#cb87-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-362"><a href="#cb87-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-363"><a href="#cb87-363" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb87-364"><a href="#cb87-364" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pcr, <span class="at">val.type =</span> <span class="st">"RMSEP"</span>) </span>
<span id="cb87-365"><a href="#cb87-365" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pcr, <span class="at">val.type =</span> <span class="st">"MSEP"</span>) </span>
<span id="cb87-366"><a href="#cb87-366" aria-hidden="true" tabindex="-1"></a><span class="co"># validationplot(salary.pcr, val.type = "R2") # inutile car augment tout le temps en fonction des composantes </span></span>
<span id="cb87-367"><a href="#cb87-367" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb87-368"><a href="#cb87-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-369"><a href="#cb87-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-370"><a href="#cb87-370" aria-hidden="true" tabindex="-1"></a>salary.pcr<span class="sc">$</span>coefficients</span>
<span id="cb87-371"><a href="#cb87-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-372"><a href="#cb87-372" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pcr <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">RMSEP</span>(salary.pcr, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-373"><a href="#cb87-373" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pcr <span class="co"># 348.3224</span></span>
<span id="cb87-374"><a href="#cb87-374" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pcr <span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(salary.pcr, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-375"><a href="#cb87-375" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pcr <span class="co"># 14 comps (sans compter l'intercept)</span></span>
<span id="cb87-376"><a href="#cb87-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-377"><a href="#cb87-377" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 3 --------------------------------------------------------------</span></span>
<span id="cb87-378"><a href="#cb87-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-379"><a href="#cb87-379" aria-hidden="true" tabindex="-1"></a>salary.pls <span class="ot">=</span> <span class="fu">plsr</span>(Salary <span class="sc">~</span>., <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> df_train, <span class="at">validation =</span> <span class="st">"CV"</span>, <span class="at">segments=</span><span class="dv">10</span>)</span>
<span id="cb87-380"><a href="#cb87-380" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salary.pls)</span>
<span id="cb87-381"><a href="#cb87-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-382"><a href="#cb87-382" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb87-383"><a href="#cb87-383" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pls, <span class="at">val.type =</span> <span class="st">"RMSEP"</span>) </span>
<span id="cb87-384"><a href="#cb87-384" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(salary.pls, <span class="at">val.type =</span> <span class="st">"MSEP"</span>) </span>
<span id="cb87-385"><a href="#cb87-385" aria-hidden="true" tabindex="-1"></a><span class="co"># validationplot(salary.pls, val.type = "R2") # inutile car augment tout le temps en fonction des composantes </span></span>
<span id="cb87-386"><a href="#cb87-386" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb87-387"><a href="#cb87-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-388"><a href="#cb87-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-389"><a href="#cb87-389" aria-hidden="true" tabindex="-1"></a>salary.pls<span class="sc">$</span>coefficients</span>
<span id="cb87-390"><a href="#cb87-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-391"><a href="#cb87-391" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pls <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">RMSEP</span>(salary.pls, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-392"><a href="#cb87-392" aria-hidden="true" tabindex="-1"></a>rmsep.cv_salary.pls <span class="co"># 348.3051</span></span>
<span id="cb87-393"><a href="#cb87-393" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pls <span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">RMSEP</span>(salary.pls, <span class="st">"CV"</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-394"><a href="#cb87-394" aria-hidden="true" tabindex="-1"></a>nb.com_rmsep.cv_salary.pls <span class="co"># 12 comps (sans compter l'intercept)</span></span>
<span id="cb87-395"><a href="#cb87-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-396"><a href="#cb87-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 4 --------------------------------------------------------------</span></span>
<span id="cb87-397"><a href="#cb87-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-398"><a href="#cb87-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul à la main entre la prdiction et le df_test</span></span>
<span id="cb87-399"><a href="#cb87-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-400"><a href="#cb87-400" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pcr <span class="ot">=</span> <span class="fu">predict</span>(salary.pcr, df_test)</span>
<span id="cb87-401"><a href="#cb87-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-402"><a href="#cb87-402" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pcr <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb87-403"><a href="#cb87-403" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr</span>
<span id="cb87-404"><a href="#cb87-404" aria-hidden="true" tabindex="-1"></a><span class="co"># 346.1988</span></span>
<span id="cb87-405"><a href="#cb87-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-406"><a href="#cb87-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-407"><a href="#cb87-407" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pls <span class="ot">=</span> <span class="fu">predict</span>(salary.pls, df_test)</span>
<span id="cb87-408"><a href="#cb87-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-409"><a href="#cb87-409" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pls <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb87-410"><a href="#cb87-410" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls</span>
<span id="cb87-411"><a href="#cb87-411" aria-hidden="true" tabindex="-1"></a><span class="co"># 356.0666</span></span>
<span id="cb87-412"><a href="#cb87-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-413"><a href="#cb87-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-414"><a href="#cb87-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Le rmsep est minimum pour PCR sur les 3 méthodes (PCR-&gt;PLS-&gt;step)</span></span>
<span id="cb87-415"><a href="#cb87-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-416"><a href="#cb87-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-417"><a href="#cb87-417" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 5 --------------------------------------------------------------</span></span>
<span id="cb87-418"><a href="#cb87-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-419"><a href="#cb87-419" aria-hidden="true" tabindex="-1"></a><span class="co"># refaire les méthodes en faisant le 10-fold 100 fois </span></span>
<span id="cb87-420"><a href="#cb87-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-421"><a href="#cb87-421" aria-hidden="true" tabindex="-1"></a>res.pcr <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb87-422"><a href="#cb87-422" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb87-423"><a href="#cb87-423" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-424"><a href="#cb87-424" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modele PCR</span></span>
<span id="cb87-425"><a href="#cb87-425" aria-hidden="true" tabindex="-1"></a>  pcr.fit <span class="ot">=</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb87-426"><a href="#cb87-426" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df,</span>
<span id="cb87-427"><a href="#cb87-427" aria-hidden="true" tabindex="-1"></a>                <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-428"><a href="#cb87-428" aria-hidden="true" tabindex="-1"></a>                <span class="at">subset =</span> indices_train,</span>
<span id="cb87-429"><a href="#cb87-429" aria-hidden="true" tabindex="-1"></a>                <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb87-430"><a href="#cb87-430" aria-hidden="true" tabindex="-1"></a>                <span class="at">segments =</span> <span class="dv">10</span>)</span>
<span id="cb87-431"><a href="#cb87-431" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-432"><a href="#cb87-432" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RMSEP</span></span>
<span id="cb87-433"><a href="#cb87-433" aria-hidden="true" tabindex="-1"></a>  RMSEP.cv <span class="ot">=</span> <span class="fu">RMSEP</span>(pcr.fit,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,]</span>
<span id="cb87-434"><a href="#cb87-434" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-435"><a href="#cb87-435" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On stocke les resultats</span></span>
<span id="cb87-436"><a href="#cb87-436" aria-hidden="true" tabindex="-1"></a>  res.pcr <span class="ot">=</span> <span class="fu">cbind</span>(res.pcr, RMSEP.cv)</span>
<span id="cb87-437"><a href="#cb87-437" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-438"><a href="#cb87-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-439"><a href="#cb87-439" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pcr, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PCR avec CV"</span>)</span>
<span id="cb87-440"><a href="#cb87-440" aria-hidden="true" tabindex="-1"></a><span class="co"># On regarde le RMSEP moyen que l'on peut obternir </span></span>
<span id="cb87-441"><a href="#cb87-441" aria-hidden="true" tabindex="-1"></a><span class="co"># pour 100 decoupages différents de notre jeu de données</span></span>
<span id="cb87-442"><a href="#cb87-442" aria-hidden="true" tabindex="-1"></a>pcr.mean.cv <span class="ot">=</span> <span class="fu">apply</span>(res.pcr, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> mean) <span class="co"># for a matrix 1 indicates rows</span></span>
<span id="cb87-443"><a href="#cb87-443" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pcr.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span>
<span id="cb87-444"><a href="#cb87-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-445"><a href="#cb87-445" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(pcr.mean.cv) </span>
<span id="cb87-446"><a href="#cb87-446" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(pcr.fit, <span class="at">ncomp =</span> <span class="dv">5</span>)</span>
<span id="cb87-447"><a href="#cb87-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-448"><a href="#cb87-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-449"><a href="#cb87-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-450"><a href="#cb87-450" aria-hidden="true" tabindex="-1"></a>res.pls <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb87-451"><a href="#cb87-451" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb87-452"><a href="#cb87-452" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-453"><a href="#cb87-453" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modele PCR</span></span>
<span id="cb87-454"><a href="#cb87-454" aria-hidden="true" tabindex="-1"></a>  pls.fit <span class="ot">=</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb87-455"><a href="#cb87-455" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df,</span>
<span id="cb87-456"><a href="#cb87-456" aria-hidden="true" tabindex="-1"></a>                <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-457"><a href="#cb87-457" aria-hidden="true" tabindex="-1"></a>                <span class="at">subset =</span> indices_train,</span>
<span id="cb87-458"><a href="#cb87-458" aria-hidden="true" tabindex="-1"></a>                <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb87-459"><a href="#cb87-459" aria-hidden="true" tabindex="-1"></a>                <span class="at">segments =</span> <span class="dv">10</span>)</span>
<span id="cb87-460"><a href="#cb87-460" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-461"><a href="#cb87-461" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RMSEP</span></span>
<span id="cb87-462"><a href="#cb87-462" aria-hidden="true" tabindex="-1"></a>  RMSEP.cv <span class="ot">=</span> <span class="fu">RMSEP</span>(pls.fit,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,]</span>
<span id="cb87-463"><a href="#cb87-463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-464"><a href="#cb87-464" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On stocke les resultats</span></span>
<span id="cb87-465"><a href="#cb87-465" aria-hidden="true" tabindex="-1"></a>  res.pls <span class="ot">=</span> <span class="fu">cbind</span>(res.pls, RMSEP.cv)</span>
<span id="cb87-466"><a href="#cb87-466" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-467"><a href="#cb87-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-468"><a href="#cb87-468" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pls, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PLS avec CV"</span>)</span>
<span id="cb87-469"><a href="#cb87-469" aria-hidden="true" tabindex="-1"></a>pls.mean.cv <span class="ot">=</span> <span class="fu">apply</span>(res.pls, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> mean) </span>
<span id="cb87-470"><a href="#cb87-470" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pls.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span>
<span id="cb87-471"><a href="#cb87-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-472"><a href="#cb87-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-473"><a href="#cb87-473" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(pls.mean.cv)</span>
<span id="cb87-474"><a href="#cb87-474" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(pls.fit, <span class="at">ncomp =</span> <span class="dv">9</span>)</span>
<span id="cb87-475"><a href="#cb87-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-476"><a href="#cb87-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-477"><a href="#cb87-477" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb87-478"><a href="#cb87-478" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pcr, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PCR"</span>)</span>
<span id="cb87-479"><a href="#cb87-479" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pcr.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span>
<span id="cb87-480"><a href="#cb87-480" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">which.min</span>(pcr.mean.cv) )</span>
<span id="cb87-481"><a href="#cb87-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-482"><a href="#cb87-482" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(res.pls, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Evolution RMSEP pour 100 PLS"</span>)</span>
<span id="cb87-483"><a href="#cb87-483" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pls.mean.cv, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd=</span><span class="dv">4</span>)</span>
<span id="cb87-484"><a href="#cb87-484" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">which.min</span>(pls.mean.cv) )</span>
<span id="cb87-485"><a href="#cb87-485" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb87-486"><a href="#cb87-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-487"><a href="#cb87-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-488"><a href="#cb87-488" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 6 --------------------------------------------------------------</span></span>
<span id="cb87-489"><a href="#cb87-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-490"><a href="#cb87-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Faire modèles finaux avec ncomp= which.min(ncomp)</span></span>
<span id="cb87-491"><a href="#cb87-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-492"><a href="#cb87-492" aria-hidden="true" tabindex="-1"></a>pcr.fit_final <span class="ot">=</span> <span class="fu">pcr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb87-493"><a href="#cb87-493" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> df, </span>
<span id="cb87-494"><a href="#cb87-494" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncomp =</span> <span class="fu">which.min</span>(pcr.mean.cv)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb87-495"><a href="#cb87-495" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-496"><a href="#cb87-496" aria-hidden="true" tabindex="-1"></a>                    <span class="at">subset =</span> indices_train,</span>
<span id="cb87-497"><a href="#cb87-497" aria-hidden="true" tabindex="-1"></a>                    <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb87-498"><a href="#cb87-498" aria-hidden="true" tabindex="-1"></a>                    <span class="at">segments =</span> <span class="dv">10</span> )</span>
<span id="cb87-499"><a href="#cb87-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-500"><a href="#cb87-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-501"><a href="#cb87-501" aria-hidden="true" tabindex="-1"></a>pls.fit_final <span class="ot">=</span> <span class="fu">plsr</span>(Salary<span class="sc">~</span>.,</span>
<span id="cb87-502"><a href="#cb87-502" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> df, </span>
<span id="cb87-503"><a href="#cb87-503" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncomp =</span> <span class="fu">which.min</span>(pls.mean.cv)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb87-504"><a href="#cb87-504" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-505"><a href="#cb87-505" aria-hidden="true" tabindex="-1"></a>                    <span class="at">subset =</span> indices_train,</span>
<span id="cb87-506"><a href="#cb87-506" aria-hidden="true" tabindex="-1"></a>                    <span class="at">validation =</span> <span class="st">"CV"</span>,</span>
<span id="cb87-507"><a href="#cb87-507" aria-hidden="true" tabindex="-1"></a>                    <span class="at">segments =</span> <span class="dv">10</span> )</span>
<span id="cb87-508"><a href="#cb87-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-509"><a href="#cb87-509" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pcr.fit_final)</span>
<span id="cb87-510"><a href="#cb87-510" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">RMSEP</span>(pcr.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-511"><a href="#cb87-511" aria-hidden="true" tabindex="-1"></a><span class="co">#  356.9369</span></span>
<span id="cb87-512"><a href="#cb87-512" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(<span class="fu">RMSEP</span>(pcr.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-513"><a href="#cb87-513" aria-hidden="true" tabindex="-1"></a><span class="co"># 18 comps</span></span>
<span id="cb87-514"><a href="#cb87-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-515"><a href="#cb87-515" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pls.fit_final)</span>
<span id="cb87-516"><a href="#cb87-516" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">RMSEP</span>(pls.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-517"><a href="#cb87-517" aria-hidden="true" tabindex="-1"></a><span class="co"># 352.8074</span></span>
<span id="cb87-518"><a href="#cb87-518" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(<span class="fu">RMSEP</span>(pls.fit_final,<span class="st">'CV'</span>)<span class="sc">$</span>val[,,])</span>
<span id="cb87-519"><a href="#cb87-519" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 comps</span></span>
<span id="cb87-520"><a href="#cb87-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-521"><a href="#cb87-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-522"><a href="#cb87-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-523"><a href="#cb87-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-524"><a href="#cb87-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Question 7 (4bis) --------------------------------------------------------------</span></span>
<span id="cb87-525"><a href="#cb87-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-526"><a href="#cb87-526" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul à la main entre la prdiction et le df_test</span></span>
<span id="cb87-527"><a href="#cb87-527" aria-hidden="true" tabindex="-1"></a>rmsep_mod.step</span>
<span id="cb87-528"><a href="#cb87-528" aria-hidden="true" tabindex="-1"></a><span class="co"># 357.7089</span></span>
<span id="cb87-529"><a href="#cb87-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-530"><a href="#cb87-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-531"><a href="#cb87-531" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pcr <span class="ot">=</span> <span class="fu">predict</span>(pcr.fit_final, df_test)</span>
<span id="cb87-532"><a href="#cb87-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-533"><a href="#cb87-533" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pcr <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb87-534"><a href="#cb87-534" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pcr</span>
<span id="cb87-535"><a href="#cb87-535" aria-hidden="true" tabindex="-1"></a><span class="co"># 312.8734</span></span>
<span id="cb87-536"><a href="#cb87-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-537"><a href="#cb87-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-538"><a href="#cb87-538" aria-hidden="true" tabindex="-1"></a>hat_df_test_salary.pls <span class="ot">=</span> <span class="fu">predict</span>(pls.fit_final, df_test)</span>
<span id="cb87-539"><a href="#cb87-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-540"><a href="#cb87-540" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((hat_df_test_salary.pls <span class="sc">-</span> df_test<span class="sc">$</span>Salary)<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb87-541"><a href="#cb87-541" aria-hidden="true" tabindex="-1"></a>rmsep_salary.pls</span>
<span id="cb87-542"><a href="#cb87-542" aria-hidden="true" tabindex="-1"></a><span class="co"># 315.9921</span></span>
<span id="cb87-543"><a href="#cb87-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-544"><a href="#cb87-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Le rmsep est minimum pour PCR sur les 3 méthodes (PCR-&gt;PLS----&gt;step)</span></span>
<span id="cb87-545"><a href="#cb87-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-546"><a href="#cb87-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-547"><a href="#cb87-547" aria-hidden="true" tabindex="-1"></a><span class="do">## FAIRE UNE BELLE CONCLUSION  SUR CHOIX DE MODELE EN GARDANT UN ESPRIT CRITIQUE </span></span>
<span id="cb87-548"><a href="#cb87-548" aria-hidden="true" tabindex="-1"></a><span class="co"># LE MODELE STEP N'EST PAS SI MAL CAR NE CONTIENT QUE 3 VAR ET ON EST SUR UN JEU DE DONNEES AVEC NA </span></span>
<span id="cb87-549"><a href="#cb87-549" aria-hidden="true" tabindex="-1"></a><span class="co"># DONC PCR ET PLS PREND TOUT LES VAR POUR PRED MAIS NA PEUVENT IMPACTER</span></span>
<span id="cb87-550"><a href="#cb87-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-551"><a href="#cb87-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-552"><a href="#cb87-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-553"><a href="#cb87-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-554"><a href="#cb87-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-555"><a href="#cb87-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-556"><a href="#cb87-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-557"><a href="#cb87-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-558"><a href="#cb87-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-559"><a href="#cb87-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-560"><a href="#cb87-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-561"><a href="#cb87-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-562"><a href="#cb87-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-563"><a href="#cb87-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-564"><a href="#cb87-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-565"><a href="#cb87-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-566"><a href="#cb87-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-567"><a href="#cb87-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-568"><a href="#cb87-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-569"><a href="#cb87-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-570"><a href="#cb87-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-571"><a href="#cb87-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-572"><a href="#cb87-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-573"><a href="#cb87-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-574"><a href="#cb87-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-575"><a href="#cb87-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-576"><a href="#cb87-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-577"><a href="#cb87-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-578"><a href="#cb87-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-579"><a href="#cb87-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-580"><a href="#cb87-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-581"><a href="#cb87-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-582"><a href="#cb87-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-583"><a href="#cb87-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-584"><a href="#cb87-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-585"><a href="#cb87-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-586"><a href="#cb87-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-587"><a href="#cb87-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-588"><a href="#cb87-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-589"><a href="#cb87-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-590"><a href="#cb87-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-591"><a href="#cb87-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-592"><a href="#cb87-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-593"><a href="#cb87-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-594"><a href="#cb87-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-595"><a href="#cb87-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-596"><a href="#cb87-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-597"><a href="#cb87-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-598"><a href="#cb87-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-599"><a href="#cb87-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-600"><a href="#cb87-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-601"><a href="#cb87-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-602"><a href="#cb87-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-603"><a href="#cb87-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-604"><a href="#cb87-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-605"><a href="#cb87-605" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2025, Clément Poupelin</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This blog is built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>